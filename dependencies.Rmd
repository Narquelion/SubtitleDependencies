---
output:
  pdf_document:
    latex_engine: xelatex
    keep_tex: yes
    fig_caption: yes
  html_document: default
always_allow_html: yes
geometry: margin=1in
documentclass: article
header-includes:
  - \setlength{\parindent}{2em}
  - \setlength{\parskip}{0em}
  - \usepackage{setspace, booktabs}
---

\doublespacing

\large Alex Kramer \hfill PSYCH 613
\par
\begin{center}{\huge Problem Set 3}\end{center}
\par

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
require(reshape2)
library(tidyverse)
library(broom)
library(dplyr)
library(ghibli)
```

```{r, include=FALSE}
    # Read in data
    df.yuuka   <- data.frame(read.table("dependencies/YukaKinoshita木下ゆうか/YukaKinoshita木下ゆうか_dependencies.csv", header=TRUE, sep=","))
    df.hikakin <- data.frame(read.table("dependencies/HikakinTV/HikakinTV_dependencies.csv", header=TRUE, sep=","))
    df.fischers <- data.frame(read.table("dependencies/Fischer's-フィッシャーズ-/Fischer's-フィッシャーズ-_dependencies.csv", header=TRUE, sep=","))
    df.hajime <- data.frame(read.table("dependencies/はじめしゃちょー(Hajime)/はじめしゃちょー(Hajime)_dependencies.csv", header=TRUE, sep=","))
    df.riku <- data.frame(read.table("dependencies/SUSHI-RAMEN【Riku】/SUSHI-RAMEN【Riku】_dependencies.csv", header=TRUE, sep=","))
```

```{r, include=FALSE}
    df.all <- dplyr::bind_rows(list("Yuuka Kinoshita"=df.yuuka, "HikakinTV"=df.hikakin, "Fischer's"=df.fischers, "Hajime Shacho"=df.hajime, "SUSHI-RAMEN (Riku)"=df.riku), .id = 'channel')
```

```{r, include=FALSE}
  # Calculate squared sentence length to match Futrell et al.
  df.all$sent_len_sq   <- df.all$num_dependencies * df.all$num_dependencies

  # Convert dataframe to "long" format wrt. original and random lengths
  df.all.long <- melt(df.all ,  id.vars = c('channel', 'video_id', 'sentence_id', 'num_dependencies', 'sent_len_sq'), variable.name = 'baseline') %>% filter(value > 5 & value < 300)
  
  df.all.long$baseline <- factor(df.all.long$baseline, levels=c("dep_total_random", "dep_total_optimal", "dep_total_true"))
  df.observed <- df.all.long %>% filter(baseline=="dep_total_true")
```

```{r, include=TRUE, echo=FALSE}
  # Plot by channel
  dep.by.channel.g <- ggplot(df.all.long, aes(y=value, x=num_dependencies, color=baseline, group=channel)) + 
    stat_bin_hex(data=df.observed, bins=20, show.legend=FALSE, inherit.aes=FALSE, 
                 aes(y=value, x=num_dependencies, fill=..density..)) +
    scale_fill_gradientn(colours=c("white","black")) +
    geom_smooth(aes(group=baseline), se = FALSE, method = "gam", formula = y ~ s(log(x))) + 
    labs(title="", x="Sentence Length", y="Total Dependency Length", color="") + 
    scale_color_manual(values = ghibli_palette("PonyoMedium")[c(3,4,6)], labels=c("Random", "Optimal", "Observed")) +
    facet_wrap(.~channel)
  dep.by.channel.g
```

```{r, include=FALSE}
ggsave("dependencies_by_channel.svg", plot=dep.by.channel.g, device="svg", dpi = 300)
ggsave("dependencies_by_channel.png", plot=dep.by.channel.g, device="png", dpi = 300)
```

```{r, include=TRUE, echo=FALSE}
  all.dependencies.g <- ggplot(df.all.long, aes(y=value, x=num_dependencies, color=baseline, group=baseline)) + 
    stat_bin_hex(data=df.observed, bins=20, show.legend=FALSE, inherit.aes=FALSE, 
                 aes(y=value, x=num_dependencies, fill=..density..)) +
    scale_fill_gradientn(colours=c("white","black")) +
    geom_smooth(aes(group=baseline), se = FALSE, method = "gam", formula = y ~ s(log(x))) + 
    labs(title="", x="Sentence Length", y="Total Dependency Length", color="") + 
    scale_color_manual(values = ghibli_palette("PonyoMedium")[c(3,4,6)], labels=c("Random", "Optimal", "Observed"))
  all.dependencies.g
```

```{r, include=FALSE}
ggsave("all_dependencies.svg", plot=all.dependencies.g, device="svg", dpi = 300)
ggsave("all_dependencies.png", plot=all.dependencies.g, device="png", dpi = 300)
```

```{r, include=TRUE, echo=FALSE}
  df.all.12 <- df.all.long %>% filter(num_dependencies == 12)
  hist.12.all.g <- ggplot(data=df.all.12, aes(y=frequency, x=value, fill=baseline, color=baseline)) + 
    geom_histogram(aes(y=..density.., fill=baseline), alpha=0.5, binwidth=1, position="identity") + 
    labs(x="Dependency Length", y="Frequency", title="") + 
    scale_fill_manual(values = ghibli_palette("PonyoMedium")[c(3,4,6)], 
                      labels = c("Random", "Optimal", "Observed"), aesthetics = c("colour", "fill"))
  hist.12.all.g
```

```{r, include=FALSE}
ggsave("hist_12_all.svg", plot=hist.12.all.g, device="svg", dpi = 300)
ggsave("hist_12_all.png", plot=hist.12.all.g, device="png", dpi = 300)
```

```{r, include=TRUE, echo=FALSE}
  hist.12.channel.g <- ggplot(data=df.all.12, aes(y=frequency, x=value, fill=baseline, color=baseline)) + 
    geom_histogram(aes(y=..density.., fill=baseline), alpha=0.5, binwidth=1, position="identity") + 
    facet_wrap(.~channel) + 
    labs(x="Dependency Length", y="Frequency", title="") + 
    scale_fill_manual(values = ghibli_palette("PonyoMedium")[c(3,4,6)], 
                      labels = c("Random", "Optimal", "Observed"), aesthetics = c("colour", "fill"))
  hist.12.channel.g
```

```{r, include=FALSE}
ggsave("hist_12_by_channel.svg", plot=hist.12.channel.g, device="svg", dpi = 300)
ggsave("hist_12_by_channel.png", plot=hist.12.channel.g, device="png", dpi = 300)
```