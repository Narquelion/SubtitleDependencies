---
output:
  pdf_document:
    latex_engine: xelatex
    keep_tex: yes
    fig_caption: yes
  html_document: default
always_allow_html: yes
geometry: margin=1in
documentclass: article
header-includes:
  - \setlength{\parindent}{2em}
  - \setlength{\parskip}{0em}
  - \usepackage{setspace, booktabs}
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)

library(ggplot2)
library(ggeffects)
library(dplyr)
library(ghibli)
library(lme4)
library(gamm4)
library(mgcv)
library(itsadug)

```

```{r load_data, include=FALSE}

df.ja.observed <- data.frame(
  read.table("../corpus/dependency_counts/ud/ja/ja_gsd_observed_dependencies.csv", 
             header=TRUE, sep=","))
df.ja.optimal  <- data.frame(
  read.table("../corpus/dependency_counts/ud/ja/ja_gsd_optimal_dependencies.csv",  
             header=TRUE, sep=","))
df.ja.random   <- data.frame(
  read.table("../corpus/dependency_counts/ud/ja/ja_gsd_random_dependencies.csv", 
             header=TRUE, sep=","))

df.ud.ja <- bind_rows(list("Observed"=df.ja.observed, "Optimal"=df.ja.optimal, 
                           "Random"=df.ja.random),  .id = 'baseline')

df.ru.observed <- data.frame(
  read.table("../corpus/dependency_counts/ud/ru/ru_syntagrus_observed_dependencies.csv", 
             header=TRUE, sep=","))
df.ru.optimal  <- data.frame(
  read.table("../corpus/dependency_counts/ud/ru/ru_syntagrus_optimal_dependencies.csv",  
             header=TRUE, sep=","))
df.ru.random   <- data.frame(
  read.table("../corpus/dependency_counts/ud/ru/ru_syntagrus_random_dependencies.csv", 
             header=TRUE, sep=","))

df.ud.ru <- bind_rows(list("Observed"=df.ru.observed, "Optimal"=df.ru.optimal, 
                           "Random"=df.ru.random),  .id = 'baseline')


df.ar.observed <- data.frame(
  read.table("../corpus/dependency_counts/ud/ar/ar_nyuad_observed_dependencies.csv", 
             header=TRUE, sep=","))
df.ar.optimal  <- data.frame(
  read.table("../corpus/dependency_counts/ud/ar/ar_nyuad_optimal_dependencies.csv",  
             header=TRUE, sep=","))
df.ar.random   <- data.frame(
  read.table("../corpus/dependency_counts/ud/ar/ar_nyuad_random_dependencies.csv", 
             header=TRUE, sep=","))

df.ud.ar <- bind_rows(list("Observed"=df.ar.observed, "Optimal"=df.ar.optimal, 
                           "Random"=df.ar.random),  .id = 'baseline')


df.ko.observed <- data.frame(
  read.table("../corpus/dependency_counts/ud/ko/ko_gsd_observed_dependencies.csv", 
             header=TRUE, sep=","))
df.ko.optimal  <- data.frame(
  read.table("../corpus/dependency_counts/ud/ko/ko_gsd_optimal_dependencies.csv",  
             header=TRUE, sep=","))
df.ko.random   <- data.frame(
  read.table("../corpus/dependency_counts/ud/ko/ko_gsd_random_dependencies.csv", 
             header=TRUE, sep=","))

df.ud.ko <- bind_rows(list("Observed"=df.ko.observed, "Optimal"=df.ko.optimal, 
                           "Random"=df.ko.random),  .id = 'baseline')


df.fr.observed <- data.frame(
  read.table("../corpus/dependency_counts/ud/fr/fr_gsd_observed_dependencies.csv", 
             header=TRUE, sep=","))
df.fr.optimal  <- data.frame(
  read.table("../corpus/dependency_counts/ud/fr/fr_gsd_optimal_dependencies.csv",  
             header=TRUE, sep=","))
df.fr.random   <- data.frame(
  read.table("../corpus/dependency_counts/ud/fr/fr_gsd_random_dependencies.csv", 
             header=TRUE, sep=","))

df.ud.fr <- bind_rows(list("Observed"=df.fr.observed, "Optimal"=df.fr.optimal, 
                           "Random"=df.fr.random),  .id = 'baseline')


df.it.observed <- data.frame(
  read.table("../corpus/dependency_counts/ud/it/it_isdt_observed_dependencies.csv", 
             header=TRUE, sep=","))
df.it.optimal  <- data.frame(
  read.table("../corpus/dependency_counts/ud/it/it_isdt_optimal_dependencies.csv",  
             header=TRUE, sep=","))
df.it.random   <- data.frame(
  read.table("../corpus/dependency_counts/ud/it/it_isdt_random_dependencies.csv", 
             header=TRUE, sep=","))

df.ud.it <- bind_rows(list("Observed"=df.it.observed, "Optimal"=df.it.optimal, 
                           "Random"=df.it.random),  .id = 'baseline')

df.tr.observed <- data.frame(
  read.table("../corpus/dependency_counts/ud/tr/tr_imst_observed_dependencies.csv", 
             header=TRUE, sep=","))
df.tr.optimal  <- data.frame(
  read.table("../corpus/dependency_counts/ud/tr/tr_imst_optimal_dependencies.csv",  
             header=TRUE, sep=","))
df.tr.random   <- data.frame(
  read.table("../corpus/dependency_counts/ud/tr/tr_imst_random_dependencies.csv", 
             header=TRUE, sep=","))

df.ud.tr <- bind_rows(list("Observed"=df.tr.observed, "Optimal"=df.tr.optimal, 
                           "Random"=df.tr.random),  .id = 'baseline')

df.en.observed <- data.frame(
  read.table("../corpus/dependency_counts/ud/en/en_ewt_observed_dependencies.csv", 
             header=TRUE, sep=","))
df.en.optimal  <- data.frame(
  read.table("../corpus/dependency_counts/ud/en/en_ewt_optimal_dependencies.csv",  
             header=TRUE, sep=","))
df.en.random   <- data.frame(
  read.table("../corpus/dependency_counts/ud/en/en_ewt_random_dependencies.csv", 
             header=TRUE, sep=","))

df.ud.en <- bind_rows(list("Observed"=df.en.observed, "Optimal"=df.en.optimal, 
                           "Random"=df.en.random),  .id = 'baseline')


```


```{r setup_data, include=FALSE}

df.all.ud <- bind_rows(list("Japanese"=df.ud.ja, "Russian"=df.ud.ru, "Italian"=df.ud.it, "Korean"=df.ud.ko, "Turkish"=df.ud.tr, "English"=df.ud.en, "French"=df.ud.fr), .id="language")

df.all.ud$sent_len_sq <- df.all.ud$total_length * df.all.ud$total_length
  
df.all.ud$baseline =  factor(df.all.ud$baseline)
df.all.ud$language =  factor(df.all.ud$language, c("English", "Italian", "French", "Russian", "Japanese", "Turkish", "Korean"))

# Observed deps for density hexagons
df.ud.observed <- df.all.ud %>% filter(baseline=="Observed")

# Sentences of length 12 (for histograms)
df.ud.12 <- df.all.ud %>% filter(total_length == 12)

# Average deps by baseline for fitted scatter plots
df.ud.avg <- df.all.ud %>% 
  group_by(language, baseline, total_length) %>% summarize("avg_length"=mean(dep_length)) %>% ungroup()

# Observed-only averages
df.ud.observed.avg <- df.ud.avg %>% filter(baseline=="Observed")


```


```{r total_aggregate_dependencies_ud, include=TRUE}

all.dependencies.ud <- ggplot(df.ud.avg %>% filter(total_length <= 15), aes(y=avg_length, x=total_length, color=baseline, group=baseline)) + 
    stat_bin_hex(data=df.ud.observed %>% filter(total_length <= 15), bins=50, binwidth = c(1, 5), show.legend=FALSE, inherit.aes=FALSE, 
                 aes(y=dep_length, x=total_length, alpha=..density..), fill="black") +
    scale_fill_gradientn(colours=c("#f8f9f5","#000000")) +
    geom_smooth(aes(group=baseline), se = TRUE, method = "gam", formula = y ~ s(log(x))) + 
    scale_color_manual(values=c("#61c75d", "#3d4f8d", "#46a1d8"), labels=c("Random", "Optimal", "Observed")) + 
    labs(title="", x="Sentence Length", y="Total Dependency Length", color="") + 
    theme(legend.position="bottom") +
    coord_cartesian(xlim=c(0,15), ylim=c(0,100)) +
    facet_wrap(.~language, ncol=4) + 
    theme_bw() + 
      theme(
          text = element_text(size = 30),
          legend.text = element_text(size = 30),
          legend.title = element_text(size = 30),
          legend.position = "bottom",
          axis.ticks = element_line(colour = "grey70", size = 0.2),
          panel.grid.major = element_line(colour = "grey70", size = 0.2),
          panel.grid.minor = element_blank()
      )

ggsave("plots/total_dependencies_ud.png", plot=all.dependencies.ud, device="png", dpi = 300, width=10)
all.dependencies.ud

```

```{r total_aggregate_dependencies_ru, include=TRUE}

all.dependencies.ud.ru <- ggplot(df.ud.ru.avg, aes(y=avg_length, x=total_length, color=baseline, group=baseline)) + 
    stat_bin_hex(data=df.ud.ru.observed %>% filter(dep_length < 300), bins=20, show.legend=FALSE, inherit.aes=FALSE, 
                 aes(y=dep_length, x=total_length, fill=..density..)) +
    scale_fill_gradientn(colours=c("#f8f9f5","#000000")) +
    geom_smooth(aes(group=baseline), se = TRUE, method = "gam", formula = y ~ s(log(x))) + 
    scale_color_manual(values = c("#5B675D", "#60C7AA", "#A1C439"), labels=c("Random", "Optimal", "Observed")) +  
    labs(title="Total Depedency Length by Sentence Length, Russian", x="Sentence Length", y="Average Total Dependency Length", color="") + 
    theme(legend.position="bottom") + theme_minimal() + 
    coord_cartesian(ylim=c(0,250)) +
    annotate(geom="text", x=0.5, y=250, label="m_rand = 0.162", hjust = 0) +
    annotate(geom="text", x=0.5, y=230, label="m_obs  = 0.107", hjust = 0) +
    annotate(geom="text", x=0.5, y=210, label="m_opt   = 0.072", hjust = 0)

ggsave("NEW_total_dependencies_aggregate_ru.png", plot=all.dependencies.ud.ru, device="png", dpi = 300)
all.dependencies.ud.ru

```
```{r total_aggregate_dependencies_tr, include=TRUE}

# NOTE: Uncorrected data only!
all.dependencies.ud.tr <- ggplot(df.ud.tr.avg, aes(y=avg_length, x=total_length, color=baseline, group=baseline)) + 
    stat_bin_hex(data=df.ud.tr.observed %>% filter(channel != "FischersCorrected"), bins=20, show.legend=FALSE, inherit.aes=FALSE, 
                 aes(y=dep_length, x=total_length, fill=..density..)) +
    scale_fill_gradientn(colours=c("#f8f9f5","#000000")) +
    geom_smooth(aes(group=baseline), se = TRUE, method = "gam", formula = y ~ s(log(x))) + 
    scale_color_manual(values = c("#5B675D", "#60C7AA", "#A1C439"), labels=c("Random", "Optimal", "Observed")) + 
    labs(title="", x="Sentence Length", y="Average Total Dependency Length", color="") + 
    theme(legend.position="bottom")

ggsave("NEW_total_dependencies_aggregate_tr.png", plot=all.dependencies.ud.tr, device="png", dpi = 300)
all.dependencies.ud.tr

```

```{r total_aggregate_dependencies}

df.ud.avg$language <- relevel(df.ud.avg$language, "Russian")
all.dependencies.ud.g <- ggplot(df.ud.avg, aes(y=avg_length, x=total_length, color=baseline, group=baseline, show.legend=FALSE)) + 
    stat_bin_hex(data=df.ud.observed %>% filter(channel != "FischersCorrected", dep_length < 300), bins=20, show.legend=FALSE, inherit.aes=FALSE, 
                 aes(y=dep_length, x=total_length, fill=..density..)) +
    scale_fill_gradientn(colours=c("#f8f9f5","#000000")) +
    geom_smooth(aes(group=baseline), se = TRUE, method = "gam", formula = y ~ s(log(x)), show.legend=FALSE) + 
    scale_color_manual(values = c("#5B675D", "#76cc41", "#00b3e7"), labels=c("Random", "Optimal", "Observed")) +  
    labs(title="", x="", y="", color="") + 
    theme(legend.position="bottom") +
    coord_cartesian(ylim=c(0,300)) +
    theme(text = element_text(size = 65)) +
    facet_wrap(.~language) + 
    scale_y_continuous(breaks=c(0,100,200,300)) + 
    theme(legend.position="right")

ggsave("NEW_total_dependencies_aggregate.png", plot=all.dependencies.ud.g, device="png", dpi = 300, width=15, height=8)
all.dependencies.ud.g
```

```{r average_dependencies_japanese_aggregate, include=TRUE, echo=FALSE}

avg.dep.all.ja <- ggplot(df.ud.ja.avg, aes(y=avg_length/total_length, x=total_length, color=baseline)) + 
    scale_fill_gradientn(colours=c("#f8f9f5","#000000")) +
    geom_smooth(aes(group=baseline), se = TRUE, method = "gam", formula = y ~ s(log(x))) + 
    scale_color_manual(values = c("#5B675D", "#60C7AA", "#A1C439"), labels=c("Random", "Optimal", "Observed")) + 
    labs(title="Average Dependency Length by Sentence Length, Japanese", x="Sentence Length", y="Average Dependency Length", color="") + 
    coord_cartesian(ylim=c(0,7)) +
    theme(legend.position="bottom") + theme_minimal()

ggsave("NEW_average_dependencies_aggregate_ja.png", plot=avg.dep.all.ja, device="png", dpi = 300)
avg.dep.all.ja

```

```{r average_dependencies_russian_aggregate, include=TRUE, echo=FALSE}

avg.dep.all.ru <- ggplot(df.ud.ru.avg, aes(y=avg_length/total_length, x=total_length, color=baseline)) + 
    scale_fill_gradientn(colours=c("#f8f9f5","#000000")) +
    geom_smooth(aes(group=baseline), se = TRUE, method = "gam", formula = y ~ s(log(x))) + 
    scale_color_manual(values = c("#5B675D", "#60C7AA", "#A1C439"), labels=c("Random", "Optimal", "Observed")) + 
    labs(title="Average Dependency Length by Sentence Length, Russian", x="Sentence Length", y="Average Dependency Length", color="") + 
    theme(legend.position="bottom") + theme_minimal() +
    coord_cartesian(ylim=c(0,7))

ggsave("NEW_average_dependencies_aggregate_ru.png", plot=avg.dep.all.ru, device="png", dpi = 300)
avg.dep.all.ru

```

```{r quantile_plots, include=TRUE, echo=FALSE}

all.dependencies.ud.g <- ggplot(df.ud.ja.avg, aes(y=avg_length, x=total_length, color=baseline, group=baseline)) + 
    stat_bin_hex(data=df.ud.ja.avg, bins=20, show.legend=FALSE, inherit.aes=FALSE, 
                 aes(y=avg_length, x=total_length, fill=..density..)) +
    scale_fill_gradientn(colours=c("white","black")) +
    geom_quantile(aes(alpha = ..quantile..)) +
    scale_color_manual(values = ghibli_palette("PonyoMedium")[c(3,4,6)], labels=c("Random", "Optimal", "Observed")) +
    labs(title="", x="Sentence Length", y="Total Dependency Length", color="") + 
    theme(legend.position="bottom")
all.dependencies.ud.g

```

```{r aggregate_hist_ja, include=TRUE, echo=FALSE}

hist.12.all.ja <- ggplot(data=df.ud.ja.12, aes(y=frequency, x=dep_length, fill=baseline, color=baseline)) + 
    geom_histogram(aes(y=..density.., fill=baseline), alpha=0.5, binwidth=1, position="identity") + 
    labs(x="Dependency Length", y="Frequency", title="Distribution of Dependency Lengths For Sentences of Length 12, Japanese") + 
    scale_fill_manual(values = c("#5B675D", "#60C7AA", "#A1C439"),
                      labels = c("Random", "Optimal", "Observed"), aesthetics = c("colour", "fill")) +
    theme(legend.position="bottom")

ggsave("NEW_histogram_dependencies_aggregate_ja.png", plot=hist.12.all.ja, device="png", dpi = 300)
hist.12.all.ja

```

```{r hist_bychannel_ja, include=TRUE, echo=FALSE}

hist.12.channel.ja <- ggplot(data=df.ud.ja.12 %>% filter(channel != "FischersCorrected"), aes(y=frequency, x=dep_length, fill=baseline, color=baseline)) + 
    geom_histogram(aes(y=..density.., fill=baseline), alpha=0.5, binwidth=1, position="identity") + 
    facet_wrap(.~channel) + 
    scale_fill_manual(values = c("#5B675D", "#60C7AA", "#A1C439"),
                      labels = c("Random", "Optimal", "Observed"), aesthetics = c("colour", "fill")) +
    labs(x="Dependency Length", y="Frequency", title="Distribution of Dependency Lengths by Channel For Length=12, Japanese") +
  theme(legend.position="bottom")

ggsave("NEW_histogram_dependencies_channel_ja.png", plot=hist.12.channel.ja, device="png", dpi = 300)
hist.12.channel.ja

```

```{r aggregate_hist_ru, include=TRUE, echo=FALSE}

hist.12.all.ru <- ggplot(data=df.ud.ru.12, aes(y=frequency, x=dep_length, fill=baseline, color=baseline)) + 
    geom_histogram(aes(y=..density.., fill=baseline), alpha=0.5, binwidth=1, position="identity") + 
    labs(x="Dependency Length", y="Frequency", title="Distribution of Dependency Lengths For Sentences of Length 12, Russian") + 
    scale_fill_manual(values = c("#5B675D", "#60C7AA", "#A1C439"),
                      labels = c("Random", "Optimal", "Observed"), aesthetics = c("colour", "fill")) +
    theme(legend.position="bottom")

ggsave("NEW_histogram_dependencies_aggregate_ru.png", plot=hist.12.all.ru, device="png", dpi = 300)
hist.12.all.ru

```

```{r hist_bychannel_ru, include=TRUE, echo=FALSE}

hist.12.channel.ru <- ggplot(data=df.ud.ru.12, aes(y=frequency, x=dep_length, fill=baseline, color=baseline)) + 
    geom_histogram(aes(y=..density.., fill=baseline), alpha=0.5, binwidth=1, position="identity") + 
    facet_wrap(.~channel) + 
    scale_fill_manual(values = c("#5B675D", "#60C7AA", "#A1C439"),
                      labels = c("Random", "Optimal", "Observed"), aesthetics = c("colour", "fill")) +
    labs(x="Dependency Length", y="Frequency", title="Distribution of Dependency Lengths by Channel For Lenth=12, Russian") +
  theme(legend.position="bottom")

ggsave("NEW_histogram_dependencies_channel_ru.png", plot=hist.12.channel.ru, device="png", dpi = 300)
hist.12.channel.ru

```

```{r}
all.dependencies.ud.g <- ggplot(df.ud.ja.avg, aes(y=avg_length, x=total_length, color=baseline, group=baseline)) + 
    stat_bin_hex(data=df.ud.ja.observed.avg, bins=20, show.legend=FALSE, inherit.aes=FALSE, 
                 aes(y=dep_length, x=total_length, fill=..density..)) +
    scale_fill_gradientn(colours=c("white","black")) +
    geom_smooth(aes(group=baseline), se = FALSE, method = "gam", formula = y ~ s(log(x)), show.legend = FALSE) + 
    labs(title="", x="", y="", color="") + 
    scale_color_manual(values = ghibli_palette("PonyoMedium")[c(3,4,6)], labels=c("Random", "Optimal", "Observed"))
  
# Plot by channel
dep.by.channel.g <- ggplot(df.ud.ja.avg, aes(y=avg_length, x=total_length, color=baseline, group=channel)) + 
    stat_bin_hex(data=df.ud.ja.observed.avg, bins=20, show.legend=FALSE, inherit.aes=FALSE, 
                 aes(y=dep_length, x=total_length, fill=..density..)) +
    scale_fill_gradientn(colours=c("white","black")) +
    geom_smooth(aes(group=baseline), se = FALSE, method = "gam", formula = y ~ s(log(x)), show.legend=FALSE) + 
    labs(title="", x="", y="", color="") + 
    theme(legend.position="top") +
    scale_color_manual(values = ghibli_palette("PonyoMedium")[c(3,4,6)], labels=c("Random", "Optimal", "Observed")) +
    facet_wrap(.~channel)
  
g <- grid.arrange(all.dependencies.ud.g, dep.by.channel.g, ncol=2, left="Total Dependency Length", bottom="Sentence Length", widths=unit(c(3,6), c("in", "in")))

```

```{r}
hist.12.channel.g <- ggplot(data=df.ud.ja.12, aes(y=frequency, x=dep_length, fill=baseline, color=baseline)) + 
    geom_histogram(aes(y=..density.., fill=baseline), alpha=0.5, binwidth=1, position="identity", show.legend=FALSE) + 
    facet_wrap(.~channel) + 
    labs(x="", y="", title="",color="", fill="") + 
    theme(legend.position="top") +
    scale_fill_manual(values = ghibli_palette("PonyoMedium")[c(3,4,6)], 
                      labels = c("Random", "Optimal", "Observed"), aesthetics = c("colour", "fill"))

hist.12.all.g <- ggplot(data=df.ud.ja.12, aes(y=frequency, x=dep_length, fill=baseline, color=baseline)) + 
    geom_histogram(aes(y=..density.., fill=baseline), alpha=0.5, binwidth=1, position="identity", show.legend=FALSE) + 
    labs(x="", y="", title="",color="", fill="") + 
    theme(legend.position="bottom") +
    scale_fill_manual(values = ghibli_palette("PonyoMedium")[c(3,4,6)], 
                      labels = c("Rand", "Opt", "Obs"), aesthetics = c("colour", "fill"))
g2 <- grid.arrange(hist.12.all.g, hist.12.channel.g, ncol=2, left="Frequency", bottom="Total Dependency Length", widths=unit(c(3,6), c("in", "in")))
```

```{r new_linear_models_setup, include=FALSE}

df.ud.fischerscorrected.lm <- df.ud.ja %>% filter(channel == "FischersCorrected") 
df.ud.fischersauto.lm      <- df.ud.ja %>% filter(channel == "FischersAuto") 
df.ud.fischers.lm          <- df.ud.ja %>% filter(channel == "FischersAuto" | channel == "FischersCorrected") 
df.ud.ja.lm                <- df.ud.ja %>% filter(channel != "FischersCorrected") 

df.ja.r <- df.ud.ja.lm %>% filter(baseline == "Random")   %>% select(channel, dep_length, sent_len_sq)
df.ja.m <- df.ud.ja.lm %>% filter(baseline == "Optimal")  %>% select(channel, dep_length, sent_len_sq)
df.ja.o <- df.ud.ja.lm %>% filter(baseline == "Observed") %>% select(channel, dep_length, sent_len_sq)

df.ru.r <- df.ud.ru %>% filter(baseline == "Random")   %>% select(channel, dep_length, sent_len_sq)
df.ru.m <- df.ud.ru %>% filter(baseline == "Optimal")  %>% select(channel, dep_length, sent_len_sq)
df.ru.o <- df.ud.ru %>% filter(baseline == "Observed") %>% select(channel, dep_length, sent_len_sq)

df.fischerscorrected.r <- df.ud.fischerscorrected.lm %>% filter(baseline == "Random")   %>% select(dep_length, sent_len_sq)
df.fischerscorrected.m <- df.ud.fischerscorrected.lm %>% filter(baseline == "Optimal")  %>% select(dep_length, sent_len_sq)
df.fischerscorrected.o <- df.ud.fischerscorrected.lm %>% filter(baseline == "Observed") %>% select(dep_length, sent_len_sq)

df.fischersauto.r <- df.ud.fischersauto.lm %>% filter(baseline == "Random")   %>% select(dep_length, sent_len_sq)
df.fischersauto.m <- df.ud.fischersauto.lm %>% filter(baseline == "Optimal")  %>% select(dep_length, sent_len_sq)
df.fischersauto.o <- df.ud.fischersauto.lm %>% filter(baseline == "Observed") %>% select(dep_length, sent_len_sq)

df.fischers.r <- df.ud.fischers.lm %>% filter(baseline == "Random")   %>% select(channel, dep_length, sent_len_sq)
df.fischers.m <- df.ud.fischers.lm %>% filter(baseline == "Optimal")  %>% select(channel, dep_length, sent_len_sq)
df.fischers.o <- df.ud.fischers.lm %>% filter(baseline == "Observed") %>% select(channel, dep_length, sent_len_sq)

```

```{r gamm}
df.ud.gam <- df.all.ud %>% filter(baseline == "Observed")
all.gam <- gam(dep_length ~ language + s(total_length, bs="cr") + s(total_length, by=language, bs="cr"), data=df.ud.gam, method="ML")
```
```{r gam_plots}
plot_smooth(all.gam, view="total_length", plot_all="language", rug=F)
plot_diff(all.gam, view="total_length", comp=list(word=c("Russian","Japanese")))
```

```{r lm_ja_random}
dependency.model.ja.r <- lm(dep_length ~ sent_len_sq, data=(df.ja.r %>% filter(sent_len_sq <= 1600)))
summary(dependency.model.ja.r)
```

```{r lm_fischers_random}
dependency.model.fischerscorrected.r <- lm(dep_length ~ sent_len_sq, data=(df.fischerscorrected.r %>% filter(sent_len_sq <= 1600)))
summary(dependency.model.fischerscorrected.r)

dependency.model.fischersauto.r <- lm(dep_length ~ sent_len_sq, data=(df.fischersauto.r %>% filter(sent_len_sq <= 1600)))
summary(dependency.model.fischersauto.r)

dependency.model.fischers.r <- lm(dep_length ~ sent_len_sq*channel, data=(df.fischers.r %>% filter(sent_len_sq <= 1600)))
summary(dependency.model.fischers.r)
```

```{r lmer_fischers_comp_random}
dependency.model.fischers.r <- lmer(dep_length ~ sent_len_sq*channel + (1|channel), data=(df.fischers.r %>% filter(sent_len_sq <= 1600)))
dependency.model.fischers.r.noint <- lmer(dep_length ~ sent_len_sq + channel + (1|channel), data=(df.fischers.r %>% filter(sent_len_sq <= 1600)))

summary(dependency.model.fischers.r)
summary(dependency.model.fischers.r.noint)

anova(dependency.model.fischers.r, dependency.model.fischers.r.noint)
```

```{r lm_ru_random}
dependency.model.ru.r <- lm(dep_length ~ sent_len_sq, data=(df.ru.r %>% filter(sent_len_sq <= 1600)))
summary(dependency.model.ru.r)
```

```{r lm_ja_observed}
dependency.model.ja.o <- lm(dep_length ~ sent_len_sq, data=(df.ja.o %>% filter(sent_len_sq <= 1600)))
summary(dependency.model.ja.o)
```

```{r lm_fischers_observed}
dependency.model.fischerscorrected.o <- lm(dep_length ~ sent_len_sq, data=(df.fischerscorrected.o %>% filter(sent_len_sq <= 1600)))
summary(dependency.model.fischerscorrected.o)

dependency.model.fischersauto.o <- lm(dep_length ~ sent_len_sq, data=(df.fischersauto.o %>% filter(sent_len_sq <= 1600)))
summary(dependency.model.fischersauto.o)
```

```{r lmer_comp_fischers_observed}
dependency.model.fischers.o <- lmer(dep_length ~ sent_len_sq*channel + (1|channel), data=(df.fischers.o %>% filter(sent_len_sq <= 1600)))
dependency.model.fischers.o.noint <- lmer(dep_length ~ sent_len_sq + channel + (1|channel), data=(df.fischers.o %>% filter(sent_len_sq <= 1600)))

summary(dependency.model.fischers.o)
summary(dependency.model.fischers.o.noint)

anova(dependency.model.fischers.o, dependency.model.fischers.o.noint)
```

```{r lm_ru_observed}
dependency.model.ru.o <- lm(dep_length ~ sent_len_sq, data=(df.ru.o %>% filter(sent_len_sq <= 1600)))
summary(dependency.model.ru.o)
```

```{r lm_ja_optimal}
dependency.model.ja.m <- lm(dep_length ~ sent_len_sq, data=(df.ja.m %>% filter(sent_len_sq <= 1600)))
summary(dependency.model.ja.m)
```

```{r lm_fischers_optimal}
dependency.model.fischerscorrected.m <- lm(dep_length ~ sent_len_sq, data=(df.fischerscorrected.m %>% filter(sent_len_sq <= 1600)))
summary(dependency.model.fischerscorrected.m)

dependency.model.fischersauto.m <- lm(dep_length ~ sent_len_sq, data=(df.fischersauto.m %>% filter(sent_len_sq <= 1600)))
summary(dependency.model.fischersauto.m)
```

```{r lmer_comp_fischers_optimal}
dependency.model.fischers.m <- lmer(dep_length ~ sent_len_sq*channel + (1|channel), data=(df.fischers.m %>% filter(sent_len_sq <= 1600)))
dependency.model.fischers.m.noint <- lmer(dep_length ~ sent_len_sq + channel + (1|channel), data=(df.fischers.m %>% filter(sent_len_sq <= 1600)))

summary(dependency.model.fischers.m)
summary(dependency.model.fischers.m.noint)

anova(dependency.model.fischers.m, dependency.model.fischers.m.noint)
```

```{r lm_ru_optimal}
dependency.model.ru.m <- lm(dep_length ~ sent_len_sq, data=(df.ru.m %>% filter(sent_len_sq <= 1600)))
summary(dependency.model.ru.m)
```

```{r}
df.ja.predicted.r <- ggpredict(dependency.model.r, terms = c("sent_len_sq"))
df.ja.predicted.o <- ggpredict(dependency.model.o, terms = c("sent_len_sq"))
df.ja.predicted.m <- ggpredict(dependency.model.m, terms = c("sent_len_sq"))

ggplot(df.ja.predicted, aes(x=sqrt(x), y=predicted, group=group, color=group)) + 
  geom_line() +
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), alpha = .1)
```

```{r old_lmer_models}
# sent  l       y   l^2   m   r
# 1     10      30  100   0   0 
# 1     10      20  100   1   0 
# 1     10      40  100   0   1 

# Structural model: y_i = β_0 + S_0 + β_1l_2^s + (β_2 + S_2)r_i + β_3r_il_2^s + e_i
# β_0 = slope
# β_1, β_2,  β_3 = fixed effects
# S_0, S_2 = random effects (intercept, slope) by sentence
# r_i = ind. var. for random
# m_i = ind. var. for optimal

# Compute models
dependency.model.or <- lmer(dep_length ~ sent_len_sq*r + sent_len_sq*o + (1|sentence_uid), data=(df.ja.auto %>% filter(channel == "Yuka")))
summary(dependency.model.or)

dependency.model.mr <- lmer(dep_length ~ sent_len_sq*r + sent_len_sq*m + (1|sentence_uid), data=(df.ja.auto %>% filter(channel == "Yuka")))
summary(dependency.model.mr)

dependency.model.o <- lmer(dep_length ~ sent_len_sq*o + (1+sent_len_sq|sentence_uid), data=temp, REML=F)
summary(dependency.model.o)

#dependency.model.nob3 <- lmer(dep_length ~ sent_len_sq + r + (1+r||(video_id:sentence_id)), data=temp)

# Random = 0, obs = 1
#dependency.model.b3 <- lmer(dep_length ~ sent_len_sq + o:sent_len_sq + o + (1+o||(video_id:sentence_id)), data=temp)
```

```{r, include=TRUE}
# Compare models
anova(dependency.model.b3,dependency.model.nob3)
```